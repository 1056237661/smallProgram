<template lang='pug'>

  //- å½•éŸ³åˆ—è¡¨
  repeat( for="{{dataList}}" key="index" index="index" item="item")
    recordcard( :dataobj.sync="item", :showCom="showCom", :index.sync='index', @praise.user='praise', @play.user='playMusic' :currentPlayIndex.sync='currentPlayIndex')
  
  noData(wx:if="{{ dataList.length == 0 }}" :text="noDataText")
    
</template>

<script>
import wepy from "wepy"
import wxRequest from '@/utils/wxRequest'
import recordCard from '@/components/record-card'
import noData from '@/components/noData'
import publick_fun from '../../mixins/publick_fun'
import wx_req from '@/utils/wxRequest/wx_req'

export default class Praised extends wepy.page {
  
  config = {
    navigationBarTitleText: 'ç‚¹è¿‡çš„èµ',
    enablePullDownRefresh: false
  }

  mixins = [publick_fun]

  components = {
    recordcard: recordCard,
    noData: noData
  }

  data = {
    noDataText:'ğŸ˜‚ï¼Œå»ç‚¹èµ ï¼Ÿ',
    praiseSrc: '../../images/praised.png',
    showCom: true,
    page: {
      PageNo: '1',
      PageSize: '10'
    },
    dataList:[],
    currentPlayIndex: -1
  }

  methods = {
    // ç‚¹èµ/å–æ¶ˆèµ
    praise(index){
      let item = this.dataList[index];
      this.fun_praise(item.MU_ID, item.LIKE_STATUE);
      item.MU_LIKE += item.LIKE_STATUE? -1 : 1 ;
      item.LIKE_STATUE = !item.LIKE_STATUE;
      this.$apply();
    },
    // æ’­æ”¾éŸ³ä¹
    playMusic(index){
      this.currentPlayIndex = index
      this.$apply()
    },
  }

  async onShow(){
    let dataList = await wxRequest.Get('/mydb/Get_UsersLike',this.page)
    this.dataList = dataList.list;
    this.Get_MessageCount();
    
    this.$apply();
  }

  onLoad(){
    // wx_req.showShareMenu();  // æ˜¾ç¤ºè½¬å‘
  }
  
  onHide() {
    this.$invoke('recordcard', 'musicStop');
  }
}
</script>

<style scoped>

</style>

